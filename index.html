<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#0ea5e9" />

    <!-- Manifest PWA e ícones -->
    <link rel="manifest" href="/manifest.webmanifest" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />
    <link rel="icon" href="/icons/icon-192.png" />

    <title>Condunity</title>

    <style>
      /* Banner PWA (só aparece se o app NÃO estiver instalado) */
      #install-banner {
        position: fixed;
        bottom: 16px; left: 50%; transform: translateX(-50%);
        max-width: 680px; width: calc(100% - 32px);
        background: #111827; color: #fff;
        border-radius: 16px; padding: 12px 16px;
        box-shadow: 0 10px 30px rgba(0,0,0,.25);
        display: none; z-index: 50;
      }
      #install-banner .row { display: flex; align-items: center; gap: 8px; }
      #install-banner button { border: 0; border-radius: 12px; padding: 8px 12px; cursor: pointer; }
      #btn-install { background: #10b981; color: #fff; }
      #btn-dismiss { background: #374151; color: #fff; }
    </style>

    <script>
      // ==========================================================
      // ENV RÁPIDA (evita erro de VITE_* indefinida em tempo de execução)
      // Preencha com os dados do seu projeto Supabase.
      // Se você usa Vite com .env, pode deixar aqui vazio.
      // ==========================================================
      window.ENV = window.ENV || {
        VITE_SUPABASE_URL: "https://kqkahzfzxbzqwjtkyqhe.supabase.co",      // ex.: "https://SEU-PROJ.supabase.co"
        VITE_SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxa2FoemZ6eGJ6cXdqdGt5cWhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzODk0MTcsImV4cCI6MjA3Mzk2NTQxN30.AyvxACf6RutV35-3gFpUlfutjG9NZzY6ZtCgDijuCrM"  // ex.: "eyJhbGciOi..."
      };

      // ==========================================================
      // Banner de instalação PWA
      // Mostra somente quando o navegador dispara o beforeinstallprompt
      // e quando o app não está em modo standalone (já instalado).
      // ==========================================================
      let deferredPrompt = null;
      function showInstallBanner() {
        const banner = document.getElementById('install-banner');
        if (!banner) return;
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
        if (isStandalone) return; // já instalado → não mostra
        banner.style.display = 'block';
      }
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        showInstallBanner();
      });
      window.addEventListener('appinstalled', () => {
        const banner = document.getElementById('install-banner');
        if (banner) banner.style.display = 'none';
        deferredPrompt = null;
      });
      window.addEventListener('DOMContentLoaded', () => {
        const btnInstall = document.getElementById('btn-install');
        const btnDismiss = document.getElementById('btn-dismiss');
        if (btnInstall) {
          btnInstall.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            await deferredPrompt.userChoice; // { outcome: 'accepted' | 'dismissed', platform }
            deferredPrompt = null;
          });
        }
        if (btnDismiss) {
          btnDismiss.addEventListener('click', () => {
            const banner = document.getElementById('install-banner');
            if (banner) banner.style.display = 'none';
          });
        }
      });

      // ==========================================================
      // Service Worker (PWA)
      // ==========================================================
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').catch(console.error);
        });
      }
    </script>
  </head>
  <body>
    <!-- Banner de instalação → aparece só quando houver evento e não estiver instalado -->
    <div id="install-banner">
      <div class="row" style="justify-content: space-between;">
        <div class="row" style="gap:12px">
          <img src="/icons/icon-72.png" alt="" width="36" height="36" style="border-radius:8px" />
          <div>
            <div style="font-weight:700;line-height:1">Instalar o Condunity</div>
            <div style="opacity:.8;font-size:12px">Acesso rápido na tela inicial</div>
          </div>
        </div>
        <div class="row">
          <button id="btn-dismiss">Agora não</button>
          <button id="btn-install">Instalar</button>
        </div>
      </div>
    </div>

    <!-- Raiz da aplicação React -->
    <div id="root"></div>

    <!-- Entrada da aplicação (Vite) -->
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
