<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CondUnity - Mansão Jorge Amado</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="favicon.ico" />
  <meta name="theme-color" content="#2563eb" />
  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />

  <style>
    :root{--bg:#f7f9fc;--card:#ffffff;--text:#0f172a;--muted:#475569;--primary:#2563eb}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;background:var(--bg);color:var(--text)}
    .header{padding:18px 16px;display:flex;align-items:center;gap:12px;background:#fff;border-bottom:1px solid #eef2f7;position:sticky;top:0;z-index:10}
    .logo{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center}
    .title{font-size:20px;font-weight:700;letter-spacing:.2px}
    .userchip{display:flex;align-items:center;gap:10px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:999px;padding:6px 10px}
    .userchip .circle{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;background:linear-gradient(135deg,#1d4ed8,#22d3ee)}
    .userchip .name{font-weight:600}
    .userchip .role{font-size:12px;color:#64748b;margin-left:4px}
    .container{max-width:1120px;margin:24px auto;padding:0 16px}
    .nav{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
    .nav button{padding:10px 14px;border:1px solid #e2e8f0;border-radius:12px;background:#fff;cursor:pointer;font-weight:600}
    .nav button.active{background:var(--primary);color:#fff;border-color:var(--primary)}
    .card{background:var(--card);border:1px solid #e2e8f0;border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 6px 18px rgba(15,23,42,.04)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    input,select,textarea{padding:10px 12px;border:1px solid #cbd5e1;border-radius:12px;font-size:14px}
    input:focus,textarea:focus,select:focus{outline:none;border-color:#93c5fd;box-shadow:0 0 0 3px rgba(37,99,235,.12)}
    button.primary{background:var(--primary);color:#fff;border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn{padding:10px 14px;border:1px solid #e2e8f0;border-radius:12px;background:#fff;cursor:pointer;font-weight:600}
    .badge{padding:4px 10px;border-radius:999px;font-size:12px;border:1px solid #cbd5e1;color:#334155;background:#f8fafc}
    .hidden{display:none}
    .list{display:grid;gap:10px}
    .item{padding:12px;border:1px solid #e2e8f0;border-radius:12px;background:#fff}
    .kv{font-size:12px;color:var(--muted)}
    .sidebar{min-width:300px}
    .flex{display:flex;gap:16px}
    .flex-1{flex:1}
    @media (max-width: 900px){ .flex{flex-direction:column}.sidebar{min-width:auto} }
    .chat-box{height:300px;overflow:auto;border:1px solid #e2e8f0;border-radius:12px;padding:10px;background:#f8fafc}
    .msg{padding:8px 10px;border-radius:12px;background:#eef2ff;margin-bottom:8px;line-height:1.35}
    hr.sep{border:0;border-top:1px solid #e2e8f0;margin:12px 0}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .partner-card{display:flex;gap:12px;align-items:center}
    .partner-card img{width:56px;height:56px;border-radius:12px;object-fit:cover;border:1px solid #e2e8f0}
    .partner-card .info{flex:1}
    .partner-card .title{font-weight:700}
    .partner-card .sub{font-size:12px;color:#64748b;margin-top:2px}
    .small{font-size:12px;color:#64748b}
  </style>
</head>
<body>
  <header class="header">
    <div class="logo">
      <!-- logo SVG -->
      <svg width="40" height="40" viewBox="0 0 40 40" fill="none"
           xmlns="http://www.w3.org/2000/svg" style="display:block;border-radius:12px">
        <defs><linearGradient id="cuG" x1="0" y1="0" x2="40" y2="40"><stop offset="0" stop-color="#1d4ed8"/><stop offset="1" stop-color="#22d3ee"/></linearGradient></defs>
        <rect width="40" height="40" rx="12" fill="url(#cuG)"/>
        <rect x="8" y="14" width="7" height="16" rx="2" fill="white" opacity=".9"/>
        <rect x="17" y="10" width="7" height="20" rx="2" fill="white" opacity=".9"/>
        <rect x="26" y="16" width="7" height="14" rx="2" fill="white" opacity=".9"/>
        <path d="M11 14 v9 c0 5 4 7 9 7s9-2 9-7v-9" stroke="#0ea5e9" stroke-width="2.2" stroke-linecap="round"/>
      </svg>
    </div>
    <div class="title">CondUnity • Mansão Jorge Amado</div>
    <div style="margin-left:auto" id="whoami"></div>
  </header>

  <div class="container">
    <!-- LOGIN -->
    <div class="card" id="authBox">
      <div class="row" id="authFields">
        <input id="email" placeholder="Email">
        <input id="password" type="password" placeholder="Senha">
        <button class="primary" onclick="login()">Entrar</button>
        <button class="btn" onclick="signup()">Criar conta</button>
      </div>
      <div class="row hidden" id="authLogged">
        <span class="badge" id="roleBadge"></span>
        <button class="btn" onclick="logout()">Sair</button>
      </div>
      <div class="small">Dica: use os logins de teste do Supabase (síndico e morador).</div>
    </div>

    <div class="nav">
      <button id="tabBtn-chat" class="active" onclick="openTab('chat')">Chat</button>
      <button id="tabBtn-posts" onclick="openTab('posts')">Comunicados</button>
      <button id="tabBtn-bookings" onclick="openTab('bookings')">Reservas</button>
      <button id="tabBtn-ads" onclick="openTab('ads')">Parceiros</button>
      <button id="tabBtn-profile" onclick="openTab('profile')">Perfil</button>
    </div>

    <div class="flex">
      <div class="flex-1">
        <!-- CHAT -->
        <section id="tab-chat" class="card">
          <h3>Chat Geral do Condomínio</h3>
          <div id="chatBox" class="chat-box"></div>
          <div class="row" style="margin-top:8px">
            <input id="chatInput" class="flex-1" placeholder="Escreva uma mensagem...">
            <button class="primary" onclick="sendMessage()">Enviar</button>
          </div>
        </section>

        <!-- POSTS -->
        <section id="tab-posts" class="card hidden">
          <h3>Comunicados</h3>
          <div id="postsList" class="list"></div>
          <div id="postForm" class="card hidden" style="margin-top:10px">
            <div class="row"><input id="postTitle" class="flex-1" placeholder="Título"></div>
            <div class="row"><textarea id="postContent" class="flex-1" placeholder="Conteúdo"></textarea></div>
            <button class="primary" onclick="createPost()">Publicar comunicado</button>
          </div>
        </section>

        <!-- BOOKINGS -->
        <section id="tab-bookings" class="card hidden">
          <h3>Reservas</h3>
          <p class="small">Use o aplicativo oficial do condomínio para reservas (LOGO Gestão Condominial).</p>
          <div class="grid2">
            <button class="btn" onclick="openLogoApp()">Abrir app LOGO (Android)</button>
            <a class="btn" href="https://play.google.com/store/apps/details?id=br.com.comunidadesmobile_logoserv&hl=pt-BR" target="_blank" rel="noopener">Ir para Play Store</a>
          </div>
          <hr class="sep">
          <div id="internalBookings" class="hidden">
            <div class="row">
              <select id="amenitySelect"></select>
              <input id="startAt" type="datetime-local">
              <input id="endAt" type="datetime-local">
              <button class="primary" onclick="requestBooking()">Solicitar</button>
            </div>
            <div id="bookingsList" class="list" style="margin-top:10px"></div>
          </div>
        </section>

        <!-- PROFILE -->
        <section id="tab-profile" class="card hidden">
          <h3>Perfil</h3>
          <div id="profileInfo"></div>
        </section>
      </div>

      <!-- ADS / PARCEIROS -->
      <aside class="sidebar">
        <section id="tab-ads" class="card">
          <h3>Parceiros</h3>
          <div id="adsBox" class="list"></div>
          <div id="partnerForm" class="hidden" style="margin-top:12px">
            <h4>Cadastrar parceiro</h4>
            <div class="row"><input id="adTitle" class="flex-1" placeholder="Título (ex: CEC Tecnologia BA)"></div>
            <div class="row"><input id="adLink" class="flex-1" placeholder="Link (WhatsApp, site, instagram...)"></div>
            <div class="row"><input id="adImage" class="flex-1" placeholder="URL da imagem (logo)"></div>
            <button class="primary" onclick="createPartner()">Publicar parceiro</button>
          </div>
        </section>
      </aside>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // === CONFIGURE AQUI ===
    const SUPABASE_URL = 'https://kqkahzfzxbzqwjtkyqhe.supabase.co';
    const SUPABASE_ANON_KEY = 'SUA-CHAVE-AQUI'; // troque pela sua chave real
    // ======================
    const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ... === TODO: aqui mantém exatamente o mesmo JS do seu index original (login, chat, posts, reservas, parceiros, etc.) === ...
    // (não cortei nada, só resumi no exemplo — copie todo seu JS original para cá)

    // Enviar no Enter (Shift+Enter = nova linha)
    (function(){
      const input = document.getElementById('chatInput');
      input.addEventListener('keydown', (e)=>{
        if(e.key==='Enter' && !e.shiftKey){
          e.preventDefault();
          sendMessage();
        }
      });
    })();
  </script>

  <!-- Registrar service worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js');
      });
    }
  </script>
</body>
</html>
